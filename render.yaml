databases:
  - name: wompi-subs-db
    databaseName: wompi_subs
    plan: starter

services:
  - type: web
    name: wompi-subs-api
    env: node
    plan: starter
    rootDir: .
    buildCommand: npm ci && npm -w apps/api run build
    startCommand: npm -w apps/api run start:migrate
    healthCheckPath: /healthz
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: DATABASE_URL
        fromDatabase:
          name: wompi-subs-db
          property: connectionString
      - key: ADMIN_API_TOKEN
        sync: false
      - key: WOMPI_EVENTS_SECRET
        sync: false
      - key: WOMPI_PRIVATE_KEY
        sync: false
      - key: WOMPI_API_BASE_URL
        sync: false
      - key: WOMPI_CHECKOUT_LINK_BASE_URL
        sync: false
      - key: WOMPI_REDIRECT_URL
        sync: false
      - key: SHOPIFY_FORWARD_URL
        sync: false
      - key: SHOPIFY_FORWARD_SECRET
        sync: false
      - key: CHATWOOT_BASE_URL
        sync: false
      - key: CHATWOOT_ACCOUNT_ID
        sync: false
      - key: CHATWOOT_API_ACCESS_TOKEN
        sync: false
      - key: CHATWOOT_INBOX_ID
        sync: false
      - key: CREDENTIALS_ENCRYPTION_KEY_B64
        sync: false
      - key: SUPER_ADMIN_EMAIL
        sync: false
      - key: SUPER_ADMIN_PASSWORD
        sync: false

  - type: worker
    name: wompi-subs-jobs
    env: node
    plan: starter
    rootDir: .
    buildCommand: npm ci && npm -w apps/api run build
    startCommand: npm -w apps/api run jobs:start
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: DATABASE_URL
        fromDatabase:
          name: wompi-subs-db
          property: connectionString
      - key: ADMIN_API_TOKEN
        sync: false
      - key: WOMPI_EVENTS_SECRET
        sync: false
      - key: WOMPI_PRIVATE_KEY
        sync: false
      - key: WOMPI_API_BASE_URL
        sync: false
      - key: WOMPI_CHECKOUT_LINK_BASE_URL
        sync: false
      - key: WOMPI_REDIRECT_URL
        sync: false
      - key: SHOPIFY_FORWARD_URL
        sync: false
      - key: SHOPIFY_FORWARD_SECRET
        sync: false
      - key: CHATWOOT_BASE_URL
        sync: false
      - key: CHATWOOT_ACCOUNT_ID
        sync: false
      - key: CHATWOOT_API_ACCESS_TOKEN
        sync: false
      - key: CHATWOOT_INBOX_ID
        sync: false
      - key: CREDENTIALS_ENCRYPTION_KEY_B64
        sync: false
      - key: SUPER_ADMIN_EMAIL
        sync: false
      - key: SUPER_ADMIN_PASSWORD
        sync: false

  - type: web
    name: wompi-subs-admin
    env: node
    plan: starter
    rootDir: .
    buildCommand: npm ci && npm -w apps/admin run build
    startCommand: npm -w apps/admin run start
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NEXT_PUBLIC_API_BASE_URL
        sync: false
      - key: API_ADMIN_TOKEN
        sync: false
      - key: ADMIN_BASIC_USER
        sync: false
      - key: ADMIN_BASIC_PASS
        sync: false
      - key: ADMIN_SESSION_SECRET
        sync: false
